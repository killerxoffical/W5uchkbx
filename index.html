
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KillerX - Auth</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #121212; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    .box { background: #222; padding: 30px; border-radius: 10px; width: 300px; box-shadow: 0 0 20px #000; }
    h2 { text-align: center; margin-bottom: 20px; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; border: none; border-radius: 5px; }
    button { background: #ff9800; color: #000; font-weight: bold; cursor: pointer; }
    #message { text-align: center; margin-top: 10px; min-height: 18px; font-size: 14px; }
    .toggle { margin-top: 15px; text-align: center; color: #aaa; cursor: pointer; font-size: 13px; }
  </style>
</head>
<body>
  <div class="box">
    <h2 id="formTitle">Login</h2>
    <input type="text" id="userId" placeholder="User ID" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="handleAuth()" id="authBtn">Login</button>
    <div id="message"></div>
    <div class="toggle" onclick="toggleMode()">Don't have an account? Register</div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAueM2O16GbLJX4TmfK7g8IZfFJRMdh1WE",
      authDomain: "ng-mods-x2.firebaseapp.com",
      databaseURL: "https://ng-mods-x2-default-rtdb.firebaseio.com",
      projectId: "ng-mods-x2",
      storageBucket: "ng-mods-x2.appspot.com",
      messagingSenderId: "1098259475064",
      appId: "1:1098259475064:android:a3e1c21da7dafd75d89b8d"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let isRegister = false;

    function toggleMode() {
      isRegister = !isRegister;
      document.getElementById("formTitle").innerText = isRegister ? "Register" : "Login";
      document.getElementById("authBtn").innerText = isRegister ? "Register" : "Login";
      document.querySelector(".toggle").innerText = isRegister ? "Already have an account? Login" : "Don't have an account? Register";
      showMessage("");
    }

    function showMessage(msg, success = false) {
      const el = document.getElementById("message");
      el.style.color = success ? "lightgreen" : "red";
      el.innerText = msg;
    }

    function handleAuth() {
      const userId = document.getElementById("userId").value.trim();
      const password = document.getElementById("password").value;
      if (!userId || !password) return showMessage("Fill all fields");

      const ref = db.ref("users/" + userId);

      if (isRegister) {
        ref.get().then(snapshot => {
          if (snapshot.exists()) return showMessage("User already exists");
          const hashed = bcrypt.hashSync(password, 10);
          ref.set({ password: hashed, createdAt: Date.now(), userId: userId }).then(() => {
            showMessage("Registration successful", true);
          }).catch(err => showMessage("Firebase write error"));
        }).catch(err => showMessage("Firebase read error"));
      } else {
        ref.get().then(snapshot => {
          if (!snapshot.exists()) return showMessage("User not found");
          const user = snapshot.val();
          const match = bcrypt.compareSync(password, user.password);
          if (match) {
            showMessage("Login successful!", true);
            // redirect here if needed
          } else {
            showMessage("Incorrect password");
          }
        }).catch(err => showMessage("Firebase read error"));
      }
    }
  </script>
</body>
</html>
